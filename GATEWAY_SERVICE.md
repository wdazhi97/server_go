# API网关服务文档

## 概述

API网关是贪吃蛇游戏微服务系统的统一入口，负责将前端请求路由到相应的后端微服务。它提供了服务发现、负载均衡、认证授权等功能。

## 功能特性

### 1. 统一路由
- 将所有前端请求通过单一入口处理
- 根据路径前缀自动路由到对应的服务

### 2. 服务发现
- 自动发现和注册内部微服务
- 支持多个服务实例的负载均衡

### 3. 统一认证
- 在网关层处理认证逻辑
- 避免每个服务重复实现认证

### 4. 限流与熔断
- 防止后端服务过载
- 提供服务降级机制

## 路由规则

| API路径 | 后端服务 | 功能 |
|---------|----------|------|
| `/auth/*` | 大厅服务 | 用户认证相关 |
| `/match/*` | 匹配服务 | 玩家匹配相关 |
| `/room/*` | 房间服务 | 房间管理相关 |
| `/leaderboard/*` | 排行榜服务 | 排行榜相关 |
| `/game/*` | 游戏服务 | 游戏逻辑相关 |
| `/friends/*` | 好友服务 | 好友管理相关 |
| `/health` | 网关自身 | 健康检查 |

## 部署方式

### 本地运行
```bash
# 构建并运行网关
./build.sh
./bin/gateway_server
```

### Docker部署
```bash
# 使用docker-compose运行（网关会自动等待其他服务启动）
docker-compose up --build
```

## 架构改进

相比直接访问各微服务的方式，API网关带来了以下改进：

1. **简化前端配置** - 前端只需配置一个网关地址
2. **服务隔离** - 内部服务不直接暴露给外部
3. **灵活扩展** - 可以轻松添加新服务而不影响前端
4. **集中管理** - 统一处理认证、日志、监控等横切关注点
5. **负载均衡** - 自动在多个服务实例间分配请求

## 故障排除

### 常见问题
- 网关无法连接到后端服务：检查服务是否已启动并在注册中心注册
- 请求路由失败：检查路径前缀是否正确
- 性能问题：检查服务发现和负载均衡配置

### 日志查看
网关会在控制台输出详细的路由信息和错误日志，便于调试。